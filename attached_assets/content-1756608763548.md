Payment Method Types/

[PayPal](https://developer.paypal.com/braintree/docs/guides/paypal/overview/)/

[Server-side](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/)

OpenAI iconAsk ChatGPT

# Server-Side Implementation

Node.jsSDKCaret down![fall back icon](https://www.paypalobjects.com/btdevdoc/braintree/img/fallback/icon--caret.png)

- Current Braintree Languages
- [Java](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/java/)
- [.NET](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/dotnet/)
- [Node.js](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node/)
- [PHP](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/php/)
- [Python](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/python/)
- [Ruby](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/ruby/)

Note

**GraphQL**

[Click here](https://developer.paypal.com/braintree/graphql/integration_guides/paypal/overview) to view the server-side implementation using GraphQL.

## Creating transactions [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#creating-transactions)

Once the customer has successfully authenticated with PayPal, include the `paymentMethodNonce` parameter in the `Transaction: Sale` call on your server.

### Updating PayPal Payment Resource After Buyer Approval [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#updating-paypal-payment-resource-after-buyer-approval)

In certain edge cases, merchants may need to update some transaction parameters, such as the total amount, after the buyer has approved the payment in the PayPal checkout window. In such cases, it is essential to include updated **line items** in the server-side call to ensure the final amount reflects the correct total.

These updates can include modifications to line items, currency, custom fields, or any other supported parameter.

To complete an update, use the PayPalPaymentResource.update() method on the server side **after** tokenization of the payment resource and **before** calling Customer.create() to vault the payment method.

Note

The paymentMethodNonce is a required parameter. The update() call returns a new nonce, which must be used with Customer.create() to ensure the updated payment resource is properly vaulted. In addition to the required parameter, merchants can include any optional fields in the update call based on what needs to be modified. The sample code snippet below includes the full list of supported parameters. You can update only the fields relevant to your specific use case.


node

Copy

```java
describe("PayPalPaymentResourceGateway", function () {
  describe("update", function () {
    it("can update a payment resource", function (done) {
      let requestParams = {
        amount: "55.00",
        amountBreakdown: {
          discount: "15.00",
          handling: "0.00",
          insurance: "5.00",
          itemTotal: "45.00",
          shipping: "10.00",
          shippingDiscount: "0.00",
          taxTotal: "10.00",
        },
        currencyIsoCode: "USD",
        customField: "0437",
        description: "This is a test",
        lineItems: [\
          {\
            description: "Shoes",\
            imageUrl: "https://example.com/products/23434/pic.png",\
            kind: TransactionLineItem.Kind.Debit,\
            name: "Name #1",\
            productCode: "23434",\
            quantity: "1",\
            totalAmount: "45.00",\
            unitAmount: "45.00",\
            unitTaxAmount: "10.00",\
            url: "https://example.com/products/23434",\
          },\
        ],
        orderId: "order-123456789",
        payeeEmail: "bt_buyer_us@paypal.com",
        paymentMethodNonce: Nonces.PayPalOneTimePayment,
        shipping: {
          firstName: "John",
          lastName: "Doe",
          streetAddress: "123 Division Street",
          extendedAddress: "Apt. #1",
          locality: "Chicago",
          region: "IL",
          postalCode: "60618",
          countryName: "United States",
          countryCodeAlpha2: "US",
          countryCodeAlpha3: "USA",
          countryCodeNumeric: "484",
          internationalPhone: {
            countryCode: "1",
            nationalNumber: "4081111111",
          },
        },
        shippingOptions: [\
          {\
            amount: "10.00",\
            id: "option1",\
            label: "fast",\
            selected: true,\
            type: "SHIPPING",\
          },\
        ],
      };
```

### Using device data [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#using-device-data)

If the PayPal transaction was initiated from a Vault record and is not a recurring transaction, [collect device data](https://developer.paypal.com/braintree/docs/guides/premium-fraud-management-tools/client-side) from the client and include the collected client device data via the top-level deviceData parameter. Doing so will help reduce decline rates.

Below includes an example call with relevant PayPal parameters and device data:

Callback
Promise

Copy

```javascript
const saleRequest = {
  amount: req.body.amount,
  paymentMethodNonce: req.body.nonce,
  deviceData: req.body.device_data,
  orderId: "Mapped to PayPal Invoice Number",
  options: {
    submitForSettlement: true,
    paypal: {
      customField: "PayPal custom field",
      description: "Description for PayPal email receipt",
    },
  }
};

gateway.transaction.sale(saleRequest, (err, result) => {
  if (err) {
    console.log("Error:  " + err);
  } else if (result.success) {
    console.log("Success! Transaction ID: " + result.transaction.id);
  } else {
    console.log("Error:  " + result.message);
  }
});
```

See the [recurring transactions](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node#recurring-transactions) section below for more information on recurring transactions.

If you want to [create a new payment method in the Vault upon a successful transaction](https://developer.paypal.com/braintree/docs/reference/request/transaction/sale/node#storing-in-vault) , use the `options-storeInVaultOnSuccess` option. If a customerId is not included, a new customer will be created. If you want to include a PayPal Billing Agreement with the vaulted payment method, use the [Checkout with Vault flow](https://developer.paypal.com/braintree/docs/guides/paypal/checkout-with-vault).

### Currency support [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#currency-support)

The customer will be charged in the currency associated with the merchantAccountId passed in the `Transaction: Sale` call. We support [all currencies that PayPal REST APIs support](https://developer.paypal.com/docs/integration/direct/rest/currency-codes/#paypal-account-payments).

For details on accepting foreign currencies with PayPal, see our [PayPal account setup guide](https://developer.paypal.com/braintree/articles/guides/payment-methods/paypal/setup-guide#foreign-currencies).

### Shipping addresses [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#shipping-addresses)

If you've collected a shipping address, you will need to pass that along with the `Transaction: Sale` call. The following fields are required when passing a shipping address for PayPal transactions:

- `shipping-firstName`
- `shipping-lastName`
- `shipping-streetAddress`
- `shipping-locality`
- `shipping-postalCode`
- `shipping-region`
- `shipping-countryCodeAlpha2`

For details on how to add a shipping address when creating a transaction, see the [transaction reference full example](https://developer.paypal.com/braintree/docs/reference/request/transaction/sale/node#full-example) . PayPal validates the shipping address, so it must follow the [PayPal address conventions](https://developer.paypal.com/docs/api/payments/v1/#definition-shipping_address).

When creating a transaction using a PayPal account stored in the Vault, see the example of [using stored addresses](https://developer.paypal.com/braintree/docs/reference/request/transaction/sale/node#using-stored-addresses) as well as the `billingAddressId` and `shippingAddressId` parameters.

### Seller Protection [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#seller-protection)

By passing a shipping address, you may also be eligible for [PayPal Seller Protection](https://www.paypal.com/us/webapps/mpp/security/seller-protection). You can check the status of Seller Protection as follows:

Callback
Promise

Copy

```javascript
gateway.transaction.find("theTransactionId", (err, transaction) => {
  transaction.paypalAccount.sellerProtectionStatus;
  // "ELIGIBLE"
});
```

## Settlement [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#settlement)

Unlike most payment types that settle in batches, [we capture PayPal funds immediately when you submit each transaction for settlement](https://developer.paypal.com/braintree/articles/guides/payment-methods/paypal/processing#settlement).

### Capturing greater than authorization amount [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#capturing-greater-than-authorization-amount)

You can't settle more than the authorized amount unless your industry and processor support settlement adjustment (settling a certain percentage over the authorized amount); [contact us](https://developer.paypal.com/braintree/help) for details.
If your capture amount exceeds the allowable limit you will receive the respective [settlement response code](https://developer.paypal.com/braintree/docs/reference/general/processor-responses/settlement-responses).

### Capturing multiple partial amounts against the same authorization [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#capturing-multiple-partial-amounts-against-the-same-authorization)

If you send physical goods to customers in multiple shipments, you can capture the total authorized amount across multiple partial settlements using `Transaction: Submit For Partial Settlement`.

## Recurring transactions [![AnchorIcon](https://www.paypalobjects.com/btdevdoc/bundles/4.3.8/_assets/anchor-PKYVW2VT.svg)](https://developer.paypal.com/braintree/docs/guides/paypal/server-side/node\#recurring-transactions)

[Recurring payments](https://developer.paypal.com/braintree/docs/guides/paypal/recurring-payments/javascript/v3/) are merchant-initiated payments based on a schedule or other service usage criteria and fall into several categories based on billing frequency and amount. `transactionSource` parameter with a value of `recurring` if the customer is not present when you create a PayPal transaction from their Vault record. Typical examples are a recurring subscription or an automatic top-up charge.

Note

You won't need to do this if you're using our [recurring billing](https://developer.paypal.com/braintree/docs/guides/recurring-billing/overview) system – our logic creates subscription transactions with this parameter automatically. If you've built your own recurring logic, though, be sure your transaction sale calls include the recurring parameter.

Callback
Promise

Copy

```javascript
gateway.transaction.sale({
  amount: "1000.00",
  paymentMethodToken: "theToken",
  transactionSource: "recurring",
  options: {
    submitForSettlement: true,
  }
}, function(err, result) { });
```

## See also

- [Dynamic descriptors on PayPal transactions](https://developer.paypal.com/braintree/docs/reference/request/transaction/sale/ruby#paypal)
- [Handling result objects](https://developer.paypal.com/braintree/docs/reference/general/result-objects/ruby)

[Next Page: Testing and Go Live →](https://developer.paypal.com/braintree/docs/guides/paypal/testing-go-live)

#### If you accept cookies, we’ll use them to improve and customize your experience and enable our partners to show you personalized PayPal ads when you visit other sites. [Manage cookies and learn more](https://www.paypal.com/myaccount/privacy/cookiePrefs?locale=en_US)

AcceptDecline

Close